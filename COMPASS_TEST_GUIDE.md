# 罗盘指针准确性测试指南

## 🎯 测试目的

验证罗盘指针的：
1. **旋转方向** - 指针应该与手机旋转方向一致
2. **指向准确性** - 指针应该正确指向北方（0度）
3. **连续旋转** - 经过360度/0度边界时不应反向跳跃

---

## 📱 测试前准备

### 1. 校准手机罗盘

**Android手机**：
- 打开手机自带的"指南针"应用
- 按提示进行8字校准
- 确认指南针指向北方准确

**iPhone**：
- 打开"指南针"应用
- 跟随屏幕提示校准
- 完成后确认读数准确

### 2. 选择测试环境

✅ **推荐环境**：
- 室外开阔空间
- 远离建筑物和金属物体
- 天气晴朗（GPS信号好）

❌ **避免环境**：
- 建筑物内部（磁场干扰）
- 金属物体附近
- 高压线下方

---

## 🧪 测试步骤

### 测试1：基本方向测试

**目标**：验证指针指向北方是否准确

1. **打开应用罗盘**
   - 点击"启动罗盘"
   - 授予传感器权限

2. **对比手机指南针**
   - 同时打开手机自带指南针
   - 将手机水平放置
   - 面向正北方

3. **记录读数**
   ```
   手机指南针显示：_____ 度
   应用罗盘显示：_____ 度
   偏差：_____ 度
   ```

4. **判断标准**
   - ✅ 偏差 ≤ 5度：优秀
   - ⚠️ 偏差 5-10度：良好
   - ❌ 偏差 > 10度：需要调整

---

### 测试2：旋转方向测试

**目标**：验证指针旋转方向是否正确

#### 2.1 顺时针旋转测试

1. **起始位置**：面向正北（0度）
2. **旋转手机**：顺时针缓慢旋转90度
3. **观察**：
   - ✅ 正确：指针应该**顺时针**旋转，指向东方（90度）
   - ❌ 错误：指针**逆时针**旋转或跳跃

4. **继续旋转**：
   - 旋转到南方（180度）
   - 旋转到西方（270度）
   - 旋转回北方（360度/0度）

5. **检查点**：
   ```
   0° (北) → 90° (东) → 180° (南) → 270° (西) → 360°/0° (北)
   ```

#### 2.2 逆时针旋转测试

1. **起始位置**：面向正北（0度）
2. **旋转手机**：逆时针缓慢旋转90度
3. **观察**：
   - ✅ 正确：指针应该**逆时针**旋转，指向西方（270度）
   - ❌ 错误：指针**顺时针**旋转或跳跃

4. **继续旋转**：
   - 旋转到南方（180度）
   - 旋转到东方（90度）
   - 旋转回北方（0度）

5. **检查点**：
   ```
   0° (北) → 270° (西) → 180° (南) → 90° (东) → 0° (北)
   ```

---

### 测试3：360度边界测试

**目标**：验证经过北方（0度/360度）时不会反向

1. **起始位置**：面向东北方（约45度）

2. **顺时针旋转经过北方**：
   - 从45度开始
   - 缓慢顺时针旋转经过0度
   - 继续到315度

3. **观察重点**：
   - ✅ 正确：经过0度时指针**平滑连续**旋转，不反向
   - ❌ 错误：经过0度时指针突然**逆向**旋转340度

4. **逆时针旋转经过北方**：
   - 从315度开始
   - 缓慢逆时针旋转经过0度
   - 继续到45度

5. **观察重点**：
   - ✅ 正确：经过0度时指针平滑连续旋转
   - ❌ 错误：指针突然反向

---

### 测试4：平滑度测试

**目标**：验证指针移动是否平滑

1. **慢速旋转**：
   - 以约30度/秒的速度旋转360度
   - 观察指针是否平滑跟随

2. **快速旋转**：
   - 快速旋转180度
   - 观察指针是否及时跟上（允许1-2秒延迟）

3. **抖动测试**：
   - 保持手机静止
   - 观察指针是否稳定（允许±1度的微小摆动）

4. **判断标准**：
   - ✅ 优秀：指针平滑跟随，无明显抖动
   - ⚠️ 良好：偶尔小幅跳动
   - ❌ 需改进：频繁跳动或不跟随

---

## 📊 测试记录表

### 设备信息
```
设备型号：_________________
操作系统：_________________
浏览器：___________________
测试时间：_________________
测试地点：_________________
```

### 测试结果

| 测试项 | 预期结果 | 实际结果 | 通过？ | 备注 |
|--------|---------|---------|--------|------|
| 北方指向 (0°) | 与手机指南针一致 | ___° | ☐ | 偏差：___° |
| 东方指向 (90°) | 与手机指南针一致 | ___° | ☐ | 偏差：___° |
| 南方指向 (180°) | 与手机指南针一致 | ___° | ☐ | 偏差：___° |
| 西方指向 (270°) | 与手机指南针一致 | ___° | ☐ | 偏差：___° |
| 顺时针旋转 | 指针顺时针转 | | ☐ | |
| 逆时针旋转 | 指针逆时针转 | | ☐ | |
| 经过北方(顺时针) | 平滑连续 | | ☐ | |
| 经过北方(逆时针) | 平滑连续 | | ☐ | |
| 指针平滑度 | 无明显抖动 | | ☐ | |
| 响应速度 | 实时跟随 | | ☐ | |

---

## 🔍 问题诊断

### 症状1：指针方向完全相反（180度偏差）

**可能原因**：
- 设备需要特殊的方向反转处理

**解决方案**：
1. 检查是否为小米设备
2. 确认代码中`isXiaomi`检测是否生效
3. 如果不是小米但有此问题，需要添加该设备到反转列表

### 症状2：指针旋转方向反了

**可能原因**：
- Android设备的alpha值定义不同
- 需要或不需要360度反转

**当前实现**：
```javascript
// 小米设备：heading = 360 - heading
// 其他设备：heading = heading（直接使用）
```

**测试方法**：
1. 顺时针转动手机
2. 观察指针是顺时针还是逆时针转动
3. 如果方向相反，该设备需要反转处理

### 症状3：经过北方时指针反向跳转

**可能原因**：
- 累积旋转算法有问题

**诊断**：
- 这个问题已经通过累积旋转算法解决
- 如果仍出现，检查`updateAccumulatedRotation`函数

### 症状4：指针抖动严重

**可能原因**：
- 平滑窗口太小
- 传感器质量差
- 磁场干扰

**解决**：
- 增大`SMOOTHING_WINDOW`（当前=8）
- 更换测试环境
- 校准设备罗盘

### 症状5：指针指向偏差5-15度

**可能原因**：
- 设备未校准
- 磁偏角影響
- 传感器精度限制

**解决**：
- 重新校准设备罗盘
- 在开阔地带测试
- 这属于硬件限制，可接受范围

---

## 🛠️ 调试模式

### 启用调试信息

在`CompassAlignment.vue`中：
```javascript
const showDebug = ref(true); // 改为true
```

### 调试信息说明

显示内容：
```
Raw: 45°          # 原始传感器读数
Sensor: Android Absolute (Xiaomi)  # 传感器类型
Device: Android (Xiaomi)  # 设备检测结果
```

### 关键检查点

1. **Sensor类型**：
   - `iOS Compass` - 使用iOS专有API
   - `Android Absolute` - Android绝对方向
   - `Android Absolute (Xiaomi)` - 小米设备（会反转）
   - `Android Relative` - Android相对方向

2. **Raw vs 显示值**：
   - 小米设备：显示值 = 360 - Raw
   - 其他设备：显示值 = Raw

3. **Device检测**：
   - 确认设备类型是否正确识别

---

## 📝 反馈模板

如果发现问题，请提供以下信息：

```markdown
## 设备信息
- 型号：
- 操作系统：
- 浏览器：

## 问题描述
（选择一项或多项）
- [ ] 指针方向相反（180度偏差）
- [ ] 旋转方向反了
- [ ] 经过北方时反向跳转
- [ ] 指针抖动严重
- [ ] 指向偏差大（> 15度）
- [ ] 其他：

## 测试结果
- 手机指南针指向：___ 度
- 应用罗盘指向：___ 度
- 偏差：___ 度

## 调试信息
- Sensor类型：
- Device：
- Raw值：
- 显示值：

## 补充说明
（可选）
```

---

## ✅ 预期结果总结

完成所有测试后，应该达到：

1. ✅ **方向准确**：与手机指南针偏差 ≤ 5度
2. ✅ **旋转正确**：顺时针转手机，指针顺时针转
3. ✅ **连续平滑**：经过北方时不反向跳转
4. ✅ **响应及时**：实时跟随手机旋转
5. ✅ **稳定性好**：静止时指针稳定

---

**测试完成后请将结果反馈给开发者！** 📊✨
